# Emotional Journal - Railway Web Dashboard Deployment Guide

## Overview

Since the Railway CLI token authentication is having issues, we'll deploy using the **Railway Web Dashboard**, which is more reliable and doesn't require CLI authentication.

---

## Step 1: Prepare Your GitHub Repository

### Option A: Push to GitHub (Recommended)

```bash
cd /home/ubuntu/emotional-journal

# Initialize git if not already done
git init
git add .
git commit -m "Emotional Journal - Ready for Railway deployment"

# Add remote and push
git remote add origin https://github.com/YOUR_USERNAME/emotional-journal.git
git branch -M main
git push -u origin main
```

### Option B: Use Existing Repository

If you already have the code in GitHub, ensure it's up to date with the latest changes.

---

## Step 2: Access Railway Web Dashboard

1. Go to [railway.app](https://railway.app)
2. Sign in with your Railway account
3. Click **"New Project"**

---

## Step 3: Create New Project

### Option 1: Deploy from GitHub (Recommended)

1. Click **"Deploy from GitHub"**
2. Select **"GitHub"** as the source
3. Authorize Railway to access your GitHub account
4. Select the **emotional-journal** repository
5. Click **"Deploy"**

Railway will automatically:
- Detect Node.js project
- Build with `pnpm install && pnpm build`
- Start with `pnpm start`

### Option 2: Deploy from Docker

1. Click **"New Project"**
2. Select **"Docker"**
3. Provide the GitHub repository URL
4. Railway will use the `Dockerfile` we created

### Option 3: Deploy from Source Code

1. Click **"New Project"**
2. Select **"Empty Project"**
3. Click **"Add Service"** → **"GitHub"**
4. Connect repository

---

## Step 4: Add Database Service

After the Node.js service is created:

1. Click **"Add Service"** (in the project)
2. Select **"PostgreSQL"** (or MySQL)
3. Railway automatically creates the database
4. **Copy the DATABASE_URL** that appears

---

## Step 5: Configure Environment Variables

In the Railway dashboard, go to your Node.js service and click **"Variables"**:

### Required Variables

```
BOT_TOKEN=8487391500:AAFJ6FyBecjkGTy9hbeyb5ehy7FgDVpY4jA
NODE_ENV=production
PORT=3000
DATABASE_URL=<auto-generated-by-railway>
JWT_SECRET=<generate-random-string>
```

### Generate JWT_SECRET

```bash
# Run this to generate a random secret
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### Optional: Manus OAuth Variables

If you're using Manus OAuth (optional for local testing):

```
VITE_APP_ID=<your-manus-app-id>
OAUTH_SERVER_URL=https://api.manus.im
VITE_OAUTH_PORTAL_URL=<your-manus-portal-url>
VITE_FRONTEND_FORGE_API_URL=<your-manus-api-url>
VITE_FRONTEND_FORGE_API_KEY=<your-manus-api-key>
BUILT_IN_FORGE_API_URL=<your-manus-api-url>
BUILT_IN_FORGE_API_KEY=<your-manus-api-key>
OWNER_OPEN_ID=<your-id>
OWNER_NAME=<your-name>
```

---

## Step 6: Configure Build Settings

In the Node.js service settings:

### Build Command
```
pnpm install && pnpm build
```

### Start Command
```
pnpm start
```

### Root Directory
```
/
```

---

## Step 7: Deploy

1. Click the **"Deploy"** button
2. Watch the build logs
3. Railway will:
   - Install dependencies
   - Build the frontend
   - Bundle the backend
   - Start the server

---

## Step 8: Get Your Public URL

Once deployed:

1. Go to the **"Deployments"** tab
2. Find the latest deployment
3. Click **"View Logs"** to verify it's running
4. In the service settings, find the **"Domains"** section
5. Your URL will be something like:
   ```
   https://emotional-journal-production-xxxx.railway.app
   ```

---

## Step 9: Run Database Migrations

After deployment, run migrations to create tables:

```bash
# Via Railway CLI (if available)
railway run pnpm db:push

# Or manually in the Railway dashboard:
# 1. Go to "Deployments"
# 2. Click "View Logs"
# 3. Look for database initialization
```

---

## Step 10: Test the Deployment

### Test Frontend
- Visit your Railway URL
- Verify the React Mini App loads
- Check that styling is correct

### Test Bot
- Send a message to your Telegram bot
- Verify the bot responds with "Saved for today, [date]"
- Click the "View" button to open the Mini App

### Test Database
- Create an entry via the bot
- Check that it appears in the Mini App
- Verify the database connection is working

---

## Monitoring and Logs

### View Logs
In the Railway dashboard:
1. Go to your Node.js service
2. Click **"Logs"** tab
3. View real-time logs

### Common Log Messages

**Successful startup:**
```
[2026-02-18T...] Server running on http://localhost:3000/
[2026-02-18T...] Telegram bot initialized
[2026-02-18T...] Notification jobs started
```

**Database connected:**
```
[2026-02-18T...] Database connection successful
```

**Bot polling:**
```
[2026-02-18T...] Bot polling for messages...
```

---

## Troubleshooting

### Build Failed

**Error:** `pnpm: command not found`

**Solution:** Add to build command:
```
npm install -g pnpm && pnpm install && pnpm build
```

### Database Connection Error

**Error:** `ECONNREFUSED` or `DATABASE_URL not set`

**Solution:**
1. Verify DATABASE_URL is set in variables
2. Ensure PostgreSQL service is added
3. Check service is running in "Services" tab

### Bot Not Responding

**Error:** Bot doesn't respond to messages

**Solution:**
1. Verify BOT_TOKEN is correct
2. Check logs for polling errors
3. Ensure Telegram API is accessible

### Port Already in Use

**Error:** `EADDRINUSE: address already in use :::3000`

**Solution:**
- Railway automatically handles port allocation
- Verify PORT variable is set to 3000

### Frontend Not Loading

**Error:** Blank page or 404

**Solution:**
1. Check build completed successfully
2. Verify static files are in `dist/` directory
3. Check browser console for errors

---

## Environment Variables Reference

| Variable | Required | Example |
|----------|----------|---------|
| `BOT_TOKEN` | ✅ | `8487391500:AAFJ6FyBecjkGTy9hbeyb5ehy7FgDVpY4jA` |
| `NODE_ENV` | ✅ | `production` |
| `PORT` | ✅ | `3000` |
| `DATABASE_URL` | ✅ | `postgresql://user:pass@host/db` |
| `JWT_SECRET` | ✅ | `<random-32-char-string>` |
| `VITE_APP_ID` | ❌ | `<manus-app-id>` |
| `OAUTH_SERVER_URL` | ❌ | `https://api.manus.im` |

---

## Expected Result

After successful deployment:

✅ **Frontend**
- React Mini App accessible at Railway URL
- Scandinavian design visible
- All UI components working

✅ **Backend**
- Express server running
- tRPC endpoints responding
- Database connected

✅ **Telegram Bot**
- Bot responds to messages
- Entries saved to database
- "View" button opens Mini App

✅ **Notifications**
- Daily reminders sent
- Therapist notifications working
- Background jobs running

✅ **Database**
- All 7 tables created
- Entries stored and retrieved
- Relationships working

---

## Next Steps

1. **Push code to GitHub** (if using GitHub deployment)
2. **Create new project** in Railway dashboard
3. **Add PostgreSQL service**
4. **Set environment variables**
5. **Deploy**
6. **Run database migrations**
7. **Test all features**

---

## Quick Reference: Railway Dashboard Navigation

| Task | Path |
|------|------|
| Create Project | Dashboard → New Project |
| Add Service | Project → Add Service |
| Set Variables | Service → Variables |
| View Logs | Service → Logs |
| Configure Build | Service → Settings → Build |
| Get Public URL | Service → Domains |
| View Deployments | Service → Deployments |
| Monitor Performance | Service → Metrics |

---

## Support

- **Railway Docs:** [docs.railway.app](https://docs.railway.app)
- **Railway Status:** [status.railway.app](https://status.railway.app)
- **Railway Support:** [railway.app/support](https://railway.app/support)

---

## Summary

The Emotional Journal app is fully configured for Railway deployment:

1. ✅ Dockerfile created for containerization
2. ✅ Build and start scripts configured
3. ✅ Environment variables documented
4. ✅ Database schema ready
5. ✅ All features implemented

**Just deploy via the Railway web dashboard and you'll have a fully functional Telegram Mini App!**
