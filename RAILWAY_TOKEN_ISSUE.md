# Railway Token Issue - Resolution Guide

## Problem

The Railway token provided (`b041cbc3-e1a1-4ffd-a0f8-2497ad5d41b5`) could not be validated by the Railway CLI. This could be due to:

1. **Invalid Token Format** — The token may not be a valid Railway API token
2. **Expired Token** — The token may have expired
3. **Insufficient Permissions** — The token may not have project creation permissions
4. **Account Issues** — The Railway account may have restrictions

---

## Solution: Generate a Valid Railway Token

### Method 1: Via Railway Web Dashboard (Recommended)

1. **Go to Railway Dashboard**
   - Visit [railway.app](https://railway.app)
   - Sign in to your account

2. **Access Account Settings**
   - Click your profile icon (top-right)
   - Select "Account Settings"

3. **Navigate to Tokens**
   - Go to "Tokens" section
   - Click "Create New Token"

4. **Generate Token**
   - Give it a name (e.g., "CLI Deployment")
   - Select scope: "Full Access" or "Project Management"
   - Click "Create"
   - **Copy the token immediately** (it won't be shown again)

5. **Use the Token**
   ```bash
   export RAILWAY_TOKEN=<new-token>
   railway init --name emotional-journal
   ```

### Method 2: Via Railway CLI

```bash
# Authenticate interactively
railway login

# Or use browserless login
railway login --browserless
```

---

## Token Format

Valid Railway tokens typically look like:

```
rw_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Not like:**
```
b041cbc3-e1a1-4ffd-a0f8-2497ad5d41b5  (This is a UUID, not a Railway token)
```

---

## Verification Steps

### 1. Test Token Validity

```bash
export RAILWAY_TOKEN=<your-token>
railway whoami
```

If valid, this will show your Railway account information.

### 2. List Projects

```bash
railway list
```

This will show existing projects if token is valid.

### 3. Create New Project

```bash
railway init --name emotional-journal
```

If successful, you'll see project creation progress.

---

## Alternative: Deploy via Web Dashboard

If CLI authentication continues to fail, you can deploy via the web interface:

### 1. Create Project
- Go to [railway.app](https://railway.app)
- Click "New Project"
- Select "Empty Project"

### 2. Add Services

**Service 1: Node.js App**
- Click "Add Service"
- Select "GitHub" or "Upload Code"
- Connect repository or upload source

**Service 2: Database**
- Click "Add Service"
- Select "PostgreSQL" or "MySQL"
- Railway creates database automatically

### 3. Configure Build & Start

In the Node.js service settings:

```
Build Command: pnpm install && pnpm build
Start Command: pnpm start
```

### 4. Set Environment Variables

Add these in the service settings:

```
BOT_TOKEN=8487391500:AAFJ6FyBecjkGTy9hbeyb5ehy7FgDVpY4jA
NODE_ENV=production
PORT=3000
DATABASE_URL=<auto-generated-by-railway>
```

### 5. Deploy

Click "Deploy" and Railway will handle the rest.

---

## Step-by-Step: Getting a New Token

### Step 1: Visit Railway
```
https://railway.app
```

### Step 2: Sign In
- Use your Railway account credentials
- If you don't have an account, create one (free tier available)

### Step 3: Go to Settings
- Click profile icon (top-right corner)
- Select "Account Settings"

### Step 4: Find Tokens Section
- Look for "Tokens" or "API Tokens" in the left sidebar
- Click "Create New Token"

### Step 5: Configure Token
- **Name:** "Emotional Journal CLI"
- **Scope:** "Full Access"
- **Expiration:** "Never" (or set as needed)

### Step 6: Create & Copy
- Click "Create Token"
- **Immediately copy the token** (shown only once)
- Save it securely

### Step 7: Use Token
```bash
export RAILWAY_TOKEN=<your-new-token>
railway init --name emotional-journal
```

---

## Troubleshooting

### "Unauthorized" Error
- Token may be invalid or expired
- Generate a new token from dashboard
- Ensure token has correct permissions

### "Token not found" Error
- Token wasn't set in environment
- Use: `export RAILWAY_TOKEN=<your-token>`
- Or: `railway login --browserless`

### "Invalid scope" Error
- Token may have limited permissions
- Generate new token with "Full Access"

### "Account suspended" Error
- Check Railway account status
- May need to verify email or update billing

---

## Quick Deployment After Getting Token

Once you have a valid token:

```bash
# 1. Set token
export RAILWAY_TOKEN=<your-new-token>

# 2. Navigate to project
cd /home/ubuntu/emotional-journal

# 3. Initialize Railway project
railway init --name emotional-journal

# 4. Add database
railway add --service postgres

# 5. Set environment variables
railway variable set BOT_TOKEN 8487391500:AAFJ6FyBecjkGTy9hbeyb5ehy7FgDVpY4jA
railway variable set NODE_ENV production

# 6. Deploy
railway up

# 7. Get URL
railway open
```

---

## Expected Outcome

After successful deployment:

1. **Public URL** — Something like:
   ```
   https://emotional-journal-production-xxxx.railway.app
   ```

2. **Working Features:**
   - ✅ React Mini App loads
   - ✅ Telegram bot responds to messages
   - ✅ Entries saved to database
   - ✅ Notifications sent
   - ✅ Client-therapist connections work

3. **Logs Available:**
   ```bash
   railway logs
   ```

---

## Support

If you continue to have issues:

1. **Check Railway Status** — [status.railway.app](https://status.railway.app)
2. **Review Railway Docs** — [docs.railway.app](https://docs.railway.app)
3. **Contact Railway Support** — [railway.app/support](https://railway.app/support)

---

## Next Steps

1. Generate a valid Railway token from the dashboard
2. Export it: `export RAILWAY_TOKEN=<new-token>`
3. Run: `railway init --name emotional-journal`
4. Follow the deployment guide: `RAILWAY_DEPLOYMENT_GUIDE.md`
5. Share the final deployed URL

The app is ready to deploy — just need a valid token!
